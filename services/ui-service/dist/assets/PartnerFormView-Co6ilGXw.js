import{d as T,p as f,k as q,y as E,r as j,o as B,l as D,m as k,j as F,i as a,a as e,t as l,g as w,h,n as N,w as O,c as n,b as m,f as _,e as d,v as c,x as u,z as x,q as z,s as A,F as I}from"./index-Cr4MYUY-.js";import{_ as L}from"./AppLayout.vue_vue_type_script_setup_true_lang-DU1WgjSg.js";import{u as $}from"./partners-851dXr1N.js";import{u as R}from"./companies-Bc3UktZV.js";import{r as W}from"./ExclamationTriangleIcon-Dajd-O-b.js";const H={class:"space-y-6"},Z={class:"md:flex md:items-center md:justify-between"},G={class:"flex-1 min-w-0"},J={class:"text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate"},K={class:"mt-1 text-sm text-gray-500"},Q={class:"mt-4 flex md:mt-0 md:ml-4"},X={class:"card"},Y={key:0,class:"rounded-md bg-red-50 p-4"},ee={class:"flex"},te={class:"flex-shrink-0"},se={class:"ml-3"},ie={class:"mt-2 text-sm text-red-700"},oe={class:"grid grid-cols-1 gap-6 sm:grid-cols-2"},re={class:"mt-1"},ae={key:0,class:"mt-2 text-sm text-red-600"},le={class:"mt-1"},ne={key:0,class:"mt-2 text-sm text-red-600"},de={class:"mt-1"},me={key:0,class:"mt-2 text-sm text-red-600"},ue={class:"mt-1"},pe={key:0,class:"mt-2 text-sm text-red-600"},ce={class:"mt-1"},ve={key:0,class:"mt-2 text-sm text-red-600"},ye={class:"mt-1"},_e={key:0,class:"mt-2 text-sm text-red-600"},xe={class:"mt-1"},be={key:0,class:"mt-2 text-sm text-red-600"},fe={class:"mt-1"},ge={key:0,class:"mt-2 text-sm text-red-600"},ke={class:"space-y-2"},we={class:"flex items-center"},he={class:"flex items-center"},Ve={class:"flex items-center"},Ce={class:"flex items-center"},Pe={key:0,class:"mt-2 text-sm text-red-600"},Ue={class:"mt-1"},Se=["value"],Me={key:0,class:"mt-2 text-sm text-red-600"},Te={class:"flex items-center"},qe={class:"flex justify-end"},Ee=["disabled"],je={key:0,class:"inline-flex items-center"},Be={key:1},Ie=T({__name:"PartnerFormView",setup(De){const g=F(),V=q(),p=$(),b=R(),v=f(()=>{const r=V.params.id;return r?parseInt(r):null}),y=f(()=>!!v.value),t=E({name:"",code:"",email:"",phone:"",mobile:"",website:"",tax_id:"",industry:"",is_customer:!0,is_supplier:!1,is_vendor:!1,is_company:!1,is_active:!0,company_id:null}),i=j({}),C=f(()=>b.companyOptions||[]);async function P(){if(v.value){const r=await p.fetchPartner(v.value);r?Object.assign(t,{name:r.name,code:r.code||"",email:r.email||"",phone:r.phone||"",mobile:r.mobile||"",website:r.website||"",tax_id:r.tax_id||"",industry:r.industry||"",is_customer:r.is_customer,is_supplier:r.is_supplier,is_vendor:r.is_vendor,is_company:r.is_company,is_active:r.is_active,company_id:r.company_id}):g.push("/partners")}}function U(){return i.value={},t.name.trim()||(i.value.name="Partner name is required"),t.code&&!/^[A-Z0-9_-]+$/i.test(t.code)&&(i.value.code="Partner code can only contain letters, numbers, underscores, and hyphens"),t.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email)&&(i.value.email="Please enter a valid email address"),t.company_id||(i.value.company_id="Company is required"),!t.is_customer&&!t.is_supplier&&!t.is_vendor&&(i.value.partner_type="At least one partner type must be selected"),t.website&&!t.website.startsWith("http")&&(t.website="https://"+t.website),Object.keys(i.value).length===0}async function S(){if(U())try{if(y.value&&v.value){const r={name:t.name,code:t.code||void 0,email:t.email||void 0,phone:t.phone||void 0,mobile:t.mobile||void 0,website:t.website||void 0,tax_id:t.tax_id||void 0,industry:t.industry||void 0,is_customer:t.is_customer,is_supplier:t.is_supplier,is_vendor:t.is_vendor,is_company:t.is_company,is_active:t.is_active};await p.updatePartner(v.value,r)}else{const r={name:t.name,code:t.code||void 0,email:t.email||void 0,phone:t.phone||void 0,mobile:t.mobile||void 0,website:t.website||void 0,tax_id:t.tax_id||void 0,industry:t.industry||void 0,is_customer:t.is_customer,is_supplier:t.is_supplier,is_vendor:t.is_vendor,is_company:t.is_company,is_active:t.is_active,company_id:t.company_id};await p.createPartner(r)}g.push("/partners")}catch(r){console.error("Failed to save partner:",r)}}return B(async()=>{p.clearError(),b.companies.length===0&&await b.fetchCompanies(),await P()}),(r,s)=>{const M=N("router-link");return a(),D(L,null,{default:k(()=>[e("div",H,[e("div",Z,[e("div",G,[e("h1",J,l(y.value?"Edit Partner":"Create Partner"),1),e("p",K,l(y.value?"Update partner information":"Add a new partner to the system"),1)]),e("div",Q,[w(M,{to:"/partners",class:"btn btn-secondary mr-3"},{default:k(()=>s[14]||(s[14]=[h(" Cancel ",-1)])),_:1,__:[14]})])]),e("div",X,[e("form",{onSubmit:O(S,["prevent"]),class:"card-body space-y-6"},[_(p).error?(a(),n("div",Y,[e("div",ee,[e("div",te,[w(_(W),{class:"h-5 w-5 text-red-400"})]),e("div",se,[s[15]||(s[15]=e("h3",{class:"text-sm font-medium text-red-800"}," Error ",-1)),e("div",ie,l(_(p).error),1)])])])):m("",!0),e("div",oe,[e("div",null,[s[16]||(s[16]=e("label",{for:"name",class:"block text-sm font-medium text-gray-700"}," Partner Name * ",-1)),e("div",re,[d(e("input",{id:"name","onUpdate:modelValue":s[0]||(s[0]=o=>t.name=o),type:"text",required:"",class:u(["input",{"border-red-300":i.value.name}])},null,2),[[c,t.name]])]),i.value.name?(a(),n("p",ae,l(i.value.name),1)):m("",!0)]),e("div",null,[s[17]||(s[17]=e("label",{for:"code",class:"block text-sm font-medium text-gray-700"}," Partner Code ",-1)),e("div",le,[d(e("input",{id:"code","onUpdate:modelValue":s[1]||(s[1]=o=>t.code=o),type:"text",class:u(["input",{"border-red-300":i.value.code}])},null,2),[[c,t.code]])]),i.value.code?(a(),n("p",ne,l(i.value.code),1)):m("",!0),s[18]||(s[18]=e("p",{class:"mt-1 text-sm text-gray-500"}," Optional unique code for the partner ",-1))]),e("div",null,[s[19]||(s[19]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700"}," Email ",-1)),e("div",de,[d(e("input",{id:"email","onUpdate:modelValue":s[2]||(s[2]=o=>t.email=o),type:"email",class:u(["input",{"border-red-300":i.value.email}])},null,2),[[c,t.email]])]),i.value.email?(a(),n("p",me,l(i.value.email),1)):m("",!0)]),e("div",null,[s[20]||(s[20]=e("label",{for:"phone",class:"block text-sm font-medium text-gray-700"}," Phone ",-1)),e("div",ue,[d(e("input",{id:"phone","onUpdate:modelValue":s[3]||(s[3]=o=>t.phone=o),type:"tel",class:u(["input",{"border-red-300":i.value.phone}])},null,2),[[c,t.phone]])]),i.value.phone?(a(),n("p",pe,l(i.value.phone),1)):m("",!0)]),e("div",null,[s[21]||(s[21]=e("label",{for:"mobile",class:"block text-sm font-medium text-gray-700"}," Mobile ",-1)),e("div",ce,[d(e("input",{id:"mobile","onUpdate:modelValue":s[4]||(s[4]=o=>t.mobile=o),type:"tel",class:u(["input",{"border-red-300":i.value.mobile}])},null,2),[[c,t.mobile]])]),i.value.mobile?(a(),n("p",ve,l(i.value.mobile),1)):m("",!0)]),e("div",null,[s[22]||(s[22]=e("label",{for:"website",class:"block text-sm font-medium text-gray-700"}," Website ",-1)),e("div",ye,[d(e("input",{id:"website","onUpdate:modelValue":s[5]||(s[5]=o=>t.website=o),type:"url",class:u(["input",{"border-red-300":i.value.website}])},null,2),[[c,t.website]])]),i.value.website?(a(),n("p",_e,l(i.value.website),1)):m("",!0)]),e("div",null,[s[23]||(s[23]=e("label",{for:"tax_id",class:"block text-sm font-medium text-gray-700"}," Tax ID ",-1)),e("div",xe,[d(e("input",{id:"tax_id","onUpdate:modelValue":s[6]||(s[6]=o=>t.tax_id=o),type:"text",class:u(["input",{"border-red-300":i.value.tax_id}])},null,2),[[c,t.tax_id]])]),i.value.tax_id?(a(),n("p",be,l(i.value.tax_id),1)):m("",!0)]),e("div",null,[s[24]||(s[24]=e("label",{for:"industry",class:"block text-sm font-medium text-gray-700"}," Industry ",-1)),e("div",fe,[d(e("input",{id:"industry","onUpdate:modelValue":s[7]||(s[7]=o=>t.industry=o),type:"text",class:u(["input",{"border-red-300":i.value.industry}])},null,2),[[c,t.industry]])]),i.value.industry?(a(),n("p",ge,l(i.value.industry),1)):m("",!0)])]),e("div",null,[s[29]||(s[29]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Partner Type * ",-1)),e("div",ke,[e("div",we,[d(e("input",{id:"is_customer","onUpdate:modelValue":s[8]||(s[8]=o=>t.is_customer=o),type:"checkbox",class:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"},null,512),[[x,t.is_customer]]),s[25]||(s[25]=e("label",{for:"is_customer",class:"ml-2 block text-sm text-gray-900"}," Customer - This partner purchases goods/services from us ",-1))]),e("div",he,[d(e("input",{id:"is_supplier","onUpdate:modelValue":s[9]||(s[9]=o=>t.is_supplier=o),type:"checkbox",class:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"},null,512),[[x,t.is_supplier]]),s[26]||(s[26]=e("label",{for:"is_supplier",class:"ml-2 block text-sm text-gray-900"}," Supplier - This partner provides goods/services to us ",-1))]),e("div",Ve,[d(e("input",{id:"is_vendor","onUpdate:modelValue":s[10]||(s[10]=o=>t.is_vendor=o),type:"checkbox",class:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"},null,512),[[x,t.is_vendor]]),s[27]||(s[27]=e("label",{for:"is_vendor",class:"ml-2 block text-sm text-gray-900"}," Vendor - This partner is a service provider or contractor ",-1))]),e("div",Ce,[d(e("input",{id:"is_company","onUpdate:modelValue":s[11]||(s[11]=o=>t.is_company=o),type:"checkbox",class:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"},null,512),[[x,t.is_company]]),s[28]||(s[28]=e("label",{for:"is_company",class:"ml-2 block text-sm text-gray-900"}," Company - This partner is a company (not an individual) ",-1))])]),i.value.partner_type?(a(),n("p",Pe,l(i.value.partner_type),1)):m("",!0)]),e("div",null,[s[31]||(s[31]=e("label",{for:"company_id",class:"block text-sm font-medium text-gray-700"}," Company * ",-1)),e("div",Ue,[d(e("select",{id:"company_id","onUpdate:modelValue":s[12]||(s[12]=o=>t.company_id=o),required:"",class:u(["input",{"border-red-300":i.value.company_id}])},[s[30]||(s[30]=e("option",{value:""},"Select company",-1)),(a(!0),n(I,null,A(C.value,o=>(a(),n("option",{key:o.value,value:o.value},l(o.label),9,Se))),128))],2),[[z,t.company_id]])]),i.value.company_id?(a(),n("p",Me,l(i.value.company_id),1)):m("",!0)]),e("div",Te,[d(e("input",{id:"is_active","onUpdate:modelValue":s[13]||(s[13]=o=>t.is_active=o),type:"checkbox",class:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"},null,512),[[x,t.is_active]]),s[32]||(s[32]=e("label",{for:"is_active",class:"ml-2 block text-sm text-gray-900"}," Partner is active ",-1))]),e("div",qe,[e("button",{type:"submit",disabled:_(p).isLoading,class:"btn btn-primary"},[_(p).isLoading?(a(),n("span",je,[s[33]||(s[33]=e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),h(" "+l(y.value?"Updating...":"Creating..."),1)])):(a(),n("span",Be,l(y.value?"Update Partner":"Create Partner"),1))],8,Ee)])],32)])])]),_:1})}}});export{Ie as default};
