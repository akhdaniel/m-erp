import{A as i,B as I,r as f,p as y}from"./index-Cr4MYUY-.js";class A{async getUsers(a){return i.get("/admin/users/",{params:a})}async getUser(a){return i.get(`/admin/users/${a}`)}async createUser(a){return i.post("/admin/users/",a)}async updateUser(a,l){return i.put(`/admin/users/${a}`,l)}async deleteUser(a){return i.delete(`/admin/users/${a}`)}async activateUser(a){return i.patch(`/admin/users/${a}/activate`)}async deactivateUser(a){return i.patch(`/admin/users/${a}/deactivate`)}async resetUserPassword(a){return i.post(`/admin/users/${a}/reset-password`)}}const d=new A,C=I("users",()=>{const o=f([]),a=f(null),l=f(!1),u=f(null),p=f({total:0,page:1,size:10,pages:0}),h=y(()=>o.value.filter(r=>r.is_active)),w=y(()=>o.value.filter(r=>r.is_superuser));async function g(r){var s,t;try{l.value=!0,u.value=null;const e=await d.getUsers(r);o.value=e.items,p.value={total:e.total,page:e.page,size:e.size,pages:e.pages}}catch(e){u.value=((t=(s=e.response)==null?void 0:s.data)==null?void 0:t.detail)||"Failed to fetch users",console.error("Failed to fetch users:",e)}finally{l.value=!1}}async function m(r){var s,t;try{l.value=!0,u.value=null;const e=await d.getUser(r);return a.value=e,e}catch(e){return u.value=((t=(s=e.response)==null?void 0:s.data)==null?void 0:t.detail)||"Failed to fetch user",console.error("Failed to fetch user:",e),null}finally{l.value=!1}}async function F(r){var s,t;try{l.value=!0,u.value=null;const e=await d.createUser(r);return o.value.unshift(e),p.value.total+=1,e}catch(e){throw u.value=((t=(s=e.response)==null?void 0:s.data)==null?void 0:t.detail)||"Failed to create user",console.error("Failed to create user:",e),e}finally{l.value=!1}}async function $(r,s){var t,e,c;try{l.value=!0,u.value=null;const n=await d.updateUser(r,s),v=o.value.findIndex(U=>U.id===r);return v!==-1&&(o.value[v]=n),((t=a.value)==null?void 0:t.id)===r&&(a.value=n),n}catch(n){throw u.value=((c=(e=n.response)==null?void 0:e.data)==null?void 0:c.detail)||"Failed to update user",console.error("Failed to update user:",n),n}finally{l.value=!1}}async function x(r){var s,t,e;try{l.value=!0,u.value=null,await d.deleteUser(r),o.value=o.value.filter(c=>c.id!==r),p.value.total-=1,((s=a.value)==null?void 0:s.id)===r&&(a.value=null)}catch(c){throw u.value=((e=(t=c.response)==null?void 0:t.data)==null?void 0:e.detail)||"Failed to delete user",console.error("Failed to delete user:",c),c}finally{l.value=!1}}async function S(r,s){var t,e,c;try{l.value=!0,u.value=null;const n=s?await d.activateUser(r):await d.deactivateUser(r),v=o.value.findIndex(U=>U.id===r);v!==-1&&(o.value[v]=n),((t=a.value)==null?void 0:t.id)===r&&(a.value=n)}catch(n){throw u.value=((c=(e=n.response)==null?void 0:e.data)==null?void 0:c.detail)||`Failed to ${s?"activate":"deactivate"} user`,console.error("Failed to toggle user status:",n),n}finally{l.value=!1}}async function z(r){var s,t;try{return l.value=!0,u.value=null,(await d.resetUserPassword(r)).temporary_password}catch(e){throw u.value=((t=(s=e.response)==null?void 0:s.data)==null?void 0:t.detail)||"Failed to reset user password",console.error("Failed to reset user password:",e),e}finally{l.value=!1}}function P(){u.value=null}function _(){a.value=null}return{users:o,currentUser:a,isLoading:l,error:u,pagination:p,activeUsers:h,adminUsers:w,fetchUsers:g,fetchUser:m,createUser:F,updateUser:$,deleteUser:x,toggleUserStatus:S,resetUserPassword:z,clearError:P,clearCurrentUser:_}});export{C as u};
